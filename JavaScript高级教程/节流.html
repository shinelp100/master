<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>节流</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0,minimum-scale=1.0, user-scalable=0">

</head>

<body>

<div id="cl">click me</div>
<script>

    function changeURLArg(url,arg,arg_val){
        var pattern=arg+'=([^&]*)';
        var replaceText=arg+'='+arg_val;
        if(url.match(pattern)){
            var tmp='/('+ arg+'=)([^&]*)/gi';
            tmp=url.replace(eval(tmp),replaceText);
            return tmp;
        }else{
            if(url.match('[\?]')){
                return url+'&'+replaceText;
            }else{
                return url+'?'+replaceText;
            }
        }
        return url+'\n'+arg+'\n'+arg_val;
    }





    //方法一
    function throttle(method,context){
        clearTimeout(method.tId);
        method.tId=setTimeout(function(){
            method.call(context);
        },200);
    }
    function myFunc() {
        var localhref = "?search=123&yqcode=123&sa=1231"
//        changeURLArg(localhref,"search","sdsd");
//        console.log(localhref);
    }
    //调用
//    window.onresize=function(){
//        throttle(myFunc);
//    }
    //原生写法兼容
    document.querySelector("#cl").onclick = function(){
        throttle(myFunc);
    }
    

//    //方法二：
//    var throttle=function(fn,delay){
//        var timer=null;
//        return function(){
//            var context=this,args=arguments;
//            clearTimeout(timer);
//            timer=setTimeout(function(){
//                fn.apply(context,args);//context调用fn的方法，指针指向了fn
//            },delay);
//        }
//    }
//    //调用
//    window.onresize=throttle(myFunc,100);

    window.addEventListener("pagehide",function(){alert(1);},false);
</script>
<script>
//    /*微信接口开始*/
//    wx.config({
//        debug: false,
//        appId: '<?php echo $signPackage["appid"];?>',
//        timestamp: '<?php echo $signPackage["timestamp"];?>',
//        nonceStr: '<?php echo $signPackage["noncestr"];?>',
//        signature: '<?php echo $signPackage["signature"];?>',
//        jsApiList: [
//            // 所有要调用的 API 都要加到这个列表中
//            'onMenuShareTimeline',
//            'onMenuShareAppMessage',
//            'onMenuShareQQ',
//            'onMenuShareWeibo'
//        ]
//    });
//    var protocol = window.location.protocol + '//';
//    var primary = window.location.hostname;
//    var host_url = protocol + primary;
//    var src = getQueryString('src');
//
//    var present_url = host_url + '/active/warm-spring?yqcode=<?= $yaoqingma ?>';
//    if (!!src) {
//        present_url += '&src=' + src;
//    }
//    wx.ready(function () {
//        wx.onMenuShareTimeline({
//            title: "<?=$title?>", // 分享标题
//            link: present_url, // 分享链接
//            imgUrl: host_url + "/static/default/warm-spring/img/wap-icon.png", // 分享图标
//            desc: "<?=$desc?>", // 分享图标
//            success: function () {
//                // 用户确认分享后执行的回调函数
//            },
//            cancel: function () {
//                // 用户取消分享后执行的回调函数
//            }
//        });
//        wx.onMenuShareAppMessage({
//            title: "【春暖花开】抢5家品牌红包", // 分享标题
//            link: present_url, // 分享链接
//            imgUrl: host_url + "/static/default/warm-spring/img/wap-icon.png", // 分享图标
//            desc: "大牌任你撩，让生活更有品质！", // 分享图标
//            type: '', // 分享类型,music、video或link，不填默认为link
//            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
//            success: function () {
//                // 用户确认分享后执行的回调函数
//            },
//            cancel: function () {
//                // 用户取消分享后执行的回调函数
//            }
//        });
//        wx.onMenuShareQQ({
//            title: "【春暖花开】抢5家品牌红包", // 分享标题
//            link: present_url, // 分享链接
//            imgUrl: host_url + "/static/default/warm-spring/img/wap-icon.png", // 分享图标
//            success: function () {
//                // 用户确认分享后执行的回调函数
//            },
//            cancel: function () {
//                // 用户取消分享后执行的回调函数
//            }
//        });
//        wx.onMenuShareWeibo({
//            title: "【春暖花开】抢5家品牌红包", // 分享标题
//            link: present_url, // 分享链接
//            imgUrl: host_url + "/static/default/warm-spring/img/wap-icon.png", // 分享图标
//            success: function () {
//                // 用户确认分享后执行的回调函数
//            },
//            cancel: function () {
//                // 用户取消分享后执行的回调函数
//            }
//        });
//
//    });
//    function getQueryString(name) {
//        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
//        var r = window.location.search.substr(1).match(reg);
//        if (r != null) return unescape(r[2]);
//        //return null;
//    }
</script>

</body>
</html>