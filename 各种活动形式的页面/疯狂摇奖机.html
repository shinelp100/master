<!DOCTYPE html>
<!-- saved from url=(0045)http://hd.dlp.duiba.com.cn/preview/tiger.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    <meta name="viewport" content="target-densitydpi=device-dpi,width=640">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta content="telephone=no" name="format-detection">
    <title>疯狂摇奖机</title>
    <script>
        /* Fix viewport*/
        (function(f,u){var o=navigator.userAgent,r=640,e=f.innerWidth||r,g=f.outerHeight||e,q=f.screen.width||e,d=f.screen.availWidth||e,n=f.innerHeight||r,p=f.outerHeight||n,a=f.screen.height||n,k=f.screen.availHeight||n,l=Math.min(e,g,q,d,n,p,a,k),h=l/r,b=f.devicePixelRatio;h=Math.min(h,b);if(h<1){var t=",initial-scale="+h+",maximum-scale="+h,c=u.getElementsByTagName("meta"),j;if(/iphone|ipod/ig.test(o)){j=",user-scalable=no"}if(/android/ig.test(o)){j=""}t+=j||"";if(/zenlife-android-webview/.test(o)&&!/viewport/.test(o)){document.querySelector('html').style.zoom = h}if(top.location!=location){document.querySelector('html').style.zoom = h};for(var s=0,m;s<c.length;s++){m=c[s];if(m.name=="viewport"){m.content+=t}}}}).call(this,window,document);
    </script>
    <link rel="stylesheet" href="./疯狂摇奖机_files/base.min.css">
    <link rel="stylesheet" href="./疯狂摇奖机_files/slotMachine.css">
    <style>
.theme-color{color: #29b6b0;}
.theme-bgcolor{background-color: #29b6b0;}
.theme-bordercolor{border-color: #29b6b0;}
/* radio */
.radio-group.cur{border-color:#29b6b0; }
.radio-group .cur-arrow{border-color: #29b6b0 transparent transparent #29b6b0;}
/* description */
.description a{color: #29b6b0;}
</style><style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style></head>
<body>
    <div id="db-content">

        <style>.description a { color: #fdef2d; } </style>
        <img class="banner" src="./疯狂摇奖机_files/rfxvcxkwvy.png">
        <!-- 老虎机主体部分 -->
        <div id="slot-machine" class="slot-machine-container">
          <div class="slot-machine"><div class="slot-machine-outer"><div class="slot-machine-inner"><div class="reel reel-1" style="top: -352px;"><div class="tile tile-1"><img src="./疯狂摇奖机_files/coupon.png"></div><div class="tile tile-2"><img src="./疯狂摇奖机_files/object.png"></div><div class="tile tile-3"><img src="./疯狂摇奖机_files/phonebill.png"></div><div class="tile tile-1"><img src="./疯狂摇奖机_files/coupon.png"></div><div class="tile tile-2"><img src="./疯狂摇奖机_files/object.png"></div><div class="tile tile-3"><img src="./疯狂摇奖机_files/phonebill.png"></div></div><div class="reel reel-2" style="top: -352px;"><div class="tile tile-1"><img src="./疯狂摇奖机_files/coupon.png"></div><div class="tile tile-2"><img src="./疯狂摇奖机_files/object.png"></div><div class="tile tile-3"><img src="./疯狂摇奖机_files/phonebill.png"></div><div class="tile tile-1"><img src="./疯狂摇奖机_files/coupon.png"></div><div class="tile tile-2"><img src="./疯狂摇奖机_files/object.png"></div><div class="tile tile-3"><img src="./疯狂摇奖机_files/phonebill.png"></div></div><div class="reel reel-3" style="top: -352px;"><div class="tile tile-1"><img src="./疯狂摇奖机_files/coupon.png"></div><div class="tile tile-2"><img src="./疯狂摇奖机_files/object.png"></div><div class="tile tile-3"><img src="./疯狂摇奖机_files/phonebill.png"></div><div class="tile tile-1"><img src="./疯狂摇奖机_files/coupon.png"></div><div class="tile tile-2"><img src="./疯狂摇奖机_files/object.png"></div><div class="tile tile-3"><img src="./疯狂摇奖机_files/phonebill.png"></div></div></div></div></div>
          <div class="operate-area">
            <div class="outer">
              <div class="inner">
                <div class="integral-box">
                  <div class="integral">
                    <div class="need-credits"><i class="ico money"></i><em>免费</em></div>
                    <div class="my-credits"><p>今日免费还剩3次</p></div>
                  </div>
                </div>
                <div class="btn-box">
                  <button class="start"></button>
                </div>
              </div>
            </div>
          </div>
        </div> <!-- 老虎机主体部分 END -->

        <div class="showcase-container">
          <div class="showcase">
            <div class="showcase-outer">
              <div class="swiper-container swiper-container-horizontal">
                <ul class="swiper-wrapper" style="left: -10px;">
                  <li class="swiper-slide" data-type="alipay" data-id="1" style="margin: 0px 55px;">
                    <div class="cover">
                      <img src="./疯狂摇奖机_files/coupon.png">
                    </div>
                    <p>优惠券</p>
                  </li>
                  <li class="swiper-slide" data-type="thanks" data-id="1" style="margin: 0px 55px;">
                    <div class="cover">
                      <img src="./疯狂摇奖机_files/object.png">
                    </div>
                    <p>实物</p>
                  </li><!--
                  <li class="swiper-slide" data-type="thanks" data-id="1">
                    <div class="cover">
                      <img src="images/slotMachine/fruit.png">
                    </div>
                    <p>橙子6个</p>
                  </li>
                  <li class="swiper-slide" data-type="thanks" data-id="1">
                    <div class="cover">
                      <img src="images/slotMachine/fruit.png">
                    </div>
                    <p>橙子6个</p>
                  </li>
                  <li class="swiper-slide" data-type="alipay" data-id="1">
                    <div class="cover">
                      <img src="images/slotMachine/fruit.png">
                    </div>
                    <p>橙子6个</p>
                  </li>
                  <li class="swiper-slide" data-type="alipay" data-id="1">
                    <div class="cover">
                      <img src="images/slotMachine/fruit.png">
                    </div>
                    <p>橙子6个</p>
                  </li> -->
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div class="description-container">
          <div class="description activity">
            <h4 class="title">活动规则</h4>
            <ul>
              <li>当您参加积分抽奖时，兑换不同时间段内的一个或多个抽 奖编号，多个抽奖编号包括起号、止号以及中间连续编号为您所兑换的抽奖编号。当抽奖结束时，采用随机或人工抽取的形式抽取抽奖编号作为中奖标识。</li>
              <li>当您参加积分抽奖时，兑换不同时间段内的一个或多个抽 奖编号，多个抽奖编号包括起号。</li>
              <li>当您参加积分抽奖时，<a href="http://hd.dlp.duiba.com.cn/preview/tiger.html" title="兑换不同时间段内">兑换不同时间段内</a>的一个或多个抽 奖编号，多个抽奖编号包括起号。</li>
              <li>当您参加积分抽奖时，兑换不同时间段内的一个或多个抽 奖编号，多个抽奖编号包括起号。</li>
              <li>当您参加积分抽奖时，兑换不同时间</li>
            </ul>
          </div>
          <div class="description extra">
            <h4 class="title">额外说明</h4>  
            <ul>
              <li>如发现有作弊行为，我们有权收回奖品</li>
              <li>最终解释权归兑吧所有</li>
            </ul>
          </div>
          <div class="description other">
            <h4 class="title">
              <span>其他说明</span>
            </h4>
            <section>
              <ul> <li>惊喜奖品中奖概率约为10%，5Q币中奖概率为1%，3元支付宝中奖概率为3%，再来一次中奖概率为25%，京东20元优惠券中奖概率为10%，话费1元中奖概率为3%，滴滴10元红包中奖概率为15%。</li>
                <li>综合中奖概率为64%。</li>
              </ul>
            </section>
          </div>
        </div>
        <div class="apple">
         	<p>*兑换项和活动均与设备生产商Apple Inc.无关</p>
        </div>
        <div id="modal" class="modal">
            <div class="dialog">
                <section>
                  <h1 class="title">网络异常</h1>
                  <p class="intro">没事的，再试一遍就好了~</p>
                  <div class="ico-box"></div>
                </section>
                <footer>
                  <div class="btn-group"></div>
                </footer>
            </div>
        </div>
        
        <div id="login" class="modal">
            <div class="dialog">
                <section>
                  <h1 class="title">您还没有登录哦</h1>
                  <p class="intro">赶快去登录吧</p>
                  <div class="ico-box"><i class="ico no-login"></i></div>
                </section>
                <footer>
                  <div class="btn-group">
                    <a class="btn-primary btn close">知道了</a>
                  </div>
                </footer>
            </div>
        </div>

        <a href="http://hd.dlp.duiba.com.cn/preview/tiger.html" class="record"></a>

    </div>

    <div class="popup">
        <div class="popup-dialog">
            <div class="slide-box">
                <div class="popup-content">
                    <img id="item-img">
                    <div class="item-info">
                        <h3></h3>
                        <p></p>
                    </div>
                    <div class="popup-description"></div>
                </div>
            </div>
            <i class="popup-slideup"></i>
            <div class="loading-dialog"><img src="./疯狂摇奖机_files/loading.gif"><p>正在获取奖品信息,请稍后...</p></div>
        </div>
    </div>
    

<script src="./疯狂摇奖机_files/zepto.min.js.下载"></script>
<script src="./疯狂摇奖机_files/fastclick.js.下载"></script>
<script src="./疯狂摇奖机_files/swiper.min.js.下载"></script>
<script src="./疯狂摇奖机_files/slotMachine.js.下载"></script>
<script>
var CFG={
  activityType: "credits",//credits:积分模式，free:自由模式
  login:true,//是否已登录
  activityId:1,//活动ID
  open:true,//活动开启状态
  limitType:'day',//限制抽奖的次数类型  all:永久,day:每天
  leaveCount: 3,//剩余抽奖次数
  enoughCredits:true,//积分是否足够
  free: 3,//剩余免费次数
  freeScope:'everyday',//免费抽奖的次数类型  all:永久,day:每天
  myCredits:1234,//我的积分
  needCredits:100,//活动需要积分
  unitName:'积分',//积分单位
  getCreditsLink:'http://www.duiba.com.cn'//获取更多积分链接
}
/**
 * 请求地址
 */
var POST_ORDER_URL = './data/slotMachine.php'
var GET_ORDER_ID_URL = 'data/getOrderId.php'
var getItemDetail = './';

var Passport = (function() {
  var needCreditsElem = $('.need-credits'),
    myCreditsElem = $('.my-credits')
  
  function freeTmpl(type, free) {
    var content = ''

    content += '<i class="ico money"></i>'
    content += '<em>免费</em>'

    needCreditsElem.html(content)
    myCreditsElem.html('<p>' + type + '免费还剩' + free + '次</p>')
  }

  function creditsTmpl(needCredits, myCredits) {
    var content = ''

    content += '<i class="ico money"></i>'
    content += '<em>' + needCredits + '</em>'

    needCreditsElem.html(content)

    myCreditsElem.html('<span style="float: left;">我的积分</span><em>' + myCredits + '</em>')
  }

  function overTmpl(tmpl) {
    needCreditsElem.remove()
    myCreditsElem.html('<p class="over">' + tmpl + '</p>')
  }

  function handleCreditsType() {
    if(CFG.limitType == 'day'){
        if(CFG.leaveCount > 0 || CFG.leaveCount ===''){
            if(CFG.free>0){
                if(CFG.leaveCount ===''){
                  freeTmpl(CFG.freeScope == 'everyday' ? '今日' : '', CFG.free )
                }else{
                  freeTmpl(CFG.freeScope == 'everyday' ? '今日' : '', (CFG.free>CFG.leaveCount ? CFG.leaveCount:CFG.free))
                }
            }else{
              creditsTmpl(CFG.needCredits, CFG.myCredits)
            }
        } else {
          overTmpl('今日已抽完')
        }
    }else{
        if(CFG.leaveCount > 0 || CFG.leaveCount ===''){
            if(CFG.free > 0){
                if(CFG.leaveCount ===''){
                  freeTmpl(CFG.freeScope=='everyday'?'今日':'', CFG.free)
                }else{
                  freeTmpl(CFG.freeScope =='everyday' ? '今日' : '', (CFG.free>CFG.leaveCount ? CFG.leaveCount:CFG.free))
                }
            }else{
              creditsTmpl(CFG.needCredits, CFG.myCredits)
            }
        }else{
          overTmpl('没有抽奖机会了！')
        }
    }
  }

  function handleFreeType() {
    if(CFG.limitType == 'day'){
        if( CFG.leaveCount >0 ){
          freeTmpl('今日', CFG.leaveCount)
        }else{
          overTmpl('今日已抽完')
        }
    }else{
        if (CFG.leaveCount>0 || CFG.leaveCount ==='') {
          freeTmpl('', CFG.leaveCount)
        } else {
          overTmpl('没有抽奖机会了')
        }
    }
  }

  var exports = {
    isLogin: function() {
      return !!CFG.login
    },
    
    isClosed: function() {
      return !!!CFG.open
    },
    
    isEnoughCredits: function() {
      return CFG.enoughCredits
    },

    update: function(result) {
      for (var key in result) {
        if (typeof result[key] !== undefined && (key in CFG)) {
          CFG[key] = result[key]
        }
      }

      this.render()
    },

    render: function() {
      if (CFG.activityType === 'credits') {
        handleCreditsType()
      } else {
        handleFreeType()
      }
    }
  }

  exports.render()

  return exports
})()



/**
 * 应用
 */
function SlotMachineApp(opts) {
  this.elem = $(opts.elem)
  this.slotMachine = opts.slotMachine
  this.model = opts.model
  this.$start = this.elem.find('.start')
  this.$start.on('click', $.proxy(this.handleStart, this))

  var self = this
  var modelCallback = []

  /**
   * getOrderId
   */
  var getOrderId = this.getOrderId = (function() {
    var againTag = null

    return {
      setAgainTag: function(val) {
        againTag = val
      },
  
      request: function() {
        var data = {
          activityId: CFG.activityId
        }

        if (againTag) {
           data.againOrderId = againTag
        }
        $.ajax({
          url : GET_ORDER_ID_URL,
          type: 'POST',
          dataType: 'json',
          data: data,
          timeout: 5000,
          success: function(result) {
            if (result.success) {
              againTag = null
              self.slotMachine.start()
              self.model.setParam('orderid', result.orderId)
              self.model.request()
            } else {
              Modal.default(result.message)
            }
          },
          error: function(e) {
            Modal.networkError()
          }
        })
      }
    }

  })()

  // 中奖了
  this.model.on('winning', function(result) {
    var ary = []
    var id = result.lottery.id

    Passport.update(result)

    for (var i = 0; i < 3; i++) {
      ary.push(id)
    }

    self.slotMachine.setResult(ary)

    modelCallback.push(function() {
      Modal.winning(result.lottery)
    })
  })

  // 获得重抽的机会
  this.model.on('again', function(result) {
    var ary = []
    var id = result.lottery.id


    Passport.update(result)

    for (var i = 0; i < 3; i++) {
      ary.push(id)
    }

    getOrderId.setAgainTag(result.againTag)
    self.slotMachine.setResult(ary)
  
    modelCallback.push(function() {
      Modal.again()
    })
  })

  // 没中奖
  this.model.on('noWinning', function(result) {
    Passport.update(result)

    self.slotMachine.random()
    modelCallback.push(function() {
      Modal.noWinning()
    })
  })

  // retry
  this.model.on('retry', function() {
    self.slotMachine.random()
    modelCallback.push(function() {
      Modal.networkError()
    })
  })

  /**
   * 老虎机部分
   */
  this.slotMachine.on('start', function() {
    self.disable()
  })

  this.slotMachine.on('stop', function() {
    self.enable()

    var callback = false
    while (callback = modelCallback.pop()) {
      callback()
    }
  })

}

SlotMachineApp.prototype = {
  handleStart: function() {
    /*
    if (!Passport.isLogin()) {
      return Modal.noLogin()
    }
    
    if (Passport.isClosed()) {
      return Modal.activityClosed()
    }
    
    if (CFG.leaveCount <= 0  && CFG.leaveCount !=='') {
      if (CFG.limitType == 'all') {
        return Modal.exceedFreeCount()
      } else {
        return Modal.todayExceedFreeCount()
      }
      return
    }
    
    if (!Passport.isEnoughCredits()) {
      return Modal.lackIntegral()
    }

    this.getOrderId.request()
    */
    var self = this
    this.slotMachine.start()
    setTimeout(function() {
      self.slotMachine.random()
      setTimeout(function() {
        Modal.noWinning()
      }, 2000)
    }, 5000)
  },

  disable: function() {
    this.$start.attr('disabled', '')
  },

  enable: function() {
    this.$start.removeAttr('disabled')
  }
}

Zepto(function($) {
	Origami.fastclick(document.body);
  
  // 其他说明
  var otherDescription = $('.description.other')
  otherDescription.on('click', '.title', function() {
    otherDescription.toggleClass('show')
  })
  
  // 老虎机初始化
  var slotMachine = new SlotMachine({
   elem: document.querySelector('.slot-machine'),
   item: { height: 176 },
   imgData: [{
       id: '11',
       img: '//yun.duiba.com.cn/developer/img/activityTool/slotMachine/coupon.png'
     },
     {
       id: '12',
       img: '//yun.duiba.com.cn/developer/img/activityTool/slotMachine/object.png'
     },
     {
       id: '13',
       img: '//yun.duiba.com.cn/developer/img/activityTool/slotMachine/phonebill.png'
     }
   ]
  })
  
  // 数据模型初始化
  var orderModel = new OrderModel({
    url: POST_ORDER_URL
  })

  // 应用初始化
  var app = new SlotMachineApp({
    elem: document.body,
    slotMachine: slotMachine,
    model: orderModel
  })
  
  //获取奖品详情
  var $popup = $('.popup'),
      $content = $('.popup-content'),
      xhr;
  var swiperSlides = $('.swiper-wrapper .swiper-slide'),
      swiperSlidesCss = {}
  if (swiperSlides.length > 3) {
    swiperSlidesCss.width = swiperSlides.length * 180
    swiperSlidesCss.left = '-20px'
    // 橱窗展示
    new Swiper('.swiper-container', {
      scrollbar: false,
      scrollbarHide: true,
      slidesPerView: 'auto',
      grabCursor: true
    })
  } else {
    swiperSlidesCss.left = '-10px'
    if (swiperSlides.length === 2) {
      swiperSlides.css('margin', '0 55px')
    } else if (swiperSlides.length === 3) {
      swiperSlides.css('margin', '0 26px')
    }
  }
  $('.swiper-wrapper').css(swiperSlidesCss)

  swiperSlides.on('click', function() {
      var id = $(this).data('id');
      var type = $(this).data('type');
      if (type == 'coupon' || type == 'object' || type == 'virtual') {
          document.getElementById('db-content').ontouchmove = function(e) {
              e.preventDefault();
          }
          document.getElementsByClassName('popup')[0].ontouchmove = function(e) {
              e.preventDefault();
          }
          $content.hide();
          $popup.addClass('show').find('.loading-dialog').show();
          $('#db-content').addClass('fliter');
          $content.css('margin-top', 0)
          xhr = $.ajax({
              url: getItemDetail,
              type: 'post',
              data: {
                  id: id,
                  appid: 1
              },
              dataType: 'json',
              success: function(data) {
                  $popup.find('.loading-dialog').hide();
                  $('#item-img').attr('src', data.img);
                  $('.item-info').children('h3').html(data.title);
                  $('.item-info').children('p').html(data.valiDate);
                  $('.popup-description').html(data.description);
                  $content.show();
                  document.getElementsByClassName('popup')[0].ontouchmove = null
              },
              error: function(e) {}
          })

      }
  })

  function slideup() {
      $popup.removeClass('show');
      $('#db-content').removeClass('fliter');
      xhr.abort();
      document.getElementById('db-content').ontouchmove = null;
  }
  document.getElementsByClassName('popup-slideup')[0].addEventListener('touchend', slideup, false)
  document.getElementsByClassName('popup-slideup')[0].addEventListener('click', slideup, false)
  document.getElementsByClassName('popup-slideup')[0].addEventListener('touchmove', function(e) {
      e.preventDefault();
  }, false)
  
})
</script>

</body></html>