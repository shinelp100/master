<!DOCTYPE html>
<!-- saved from url=(0051)http://hd.dlp.duiba.com.cn/preview/scratchCard.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
    
    <meta name="viewport" content="target-densitydpi=device-dpi,width=640">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>刮刮卡</title>
	<script>
        /* Fix viewport*/
        (function(f,u){var o=navigator.userAgent,r=640,e=f.innerWidth||r,g=f.outerHeight||e,q=f.screen.width||e,d=f.screen.availWidth||e,n=f.innerHeight||r,p=f.outerHeight||n,a=f.screen.height||n,k=f.screen.availHeight||n,l=Math.min(e,g,q,d,n,p,a,k),h=l/r,b=f.devicePixelRatio;h=Math.min(h,b);if(h<1){var t=",initial-scale="+h+",maximum-scale="+h,c=u.getElementsByTagName("meta"),j;if(/iphone|ipod/ig.test(o)){j=",user-scalable=no"}if(/android/ig.test(o)){j=""}t+=j||"";if(/zenlife-android-webview/.test(o)&&!/viewport/.test(o)){document.querySelector('html').style.zoom = h}if(top.location!=location){document.querySelector('html').style.zoom = h};for(var s=0,m;s<c.length;s++){m=c[s];if(m.name=="viewport"){m.content+=t}}}}).call(this,window,document);
    </script>
    <link rel="stylesheet" href="./刮刮卡_files/normalize.css">
    <link rel="stylesheet" href="./刮刮卡_files/scratchCard.css">
<style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style></head>
<body>
	<img src="./刮刮卡_files/banner.png" height="340" width="640" alt="">
	<div class="scratch-main">
		<div class="scratch-cover-yellow"></div>
		<div class="scratch-cover-gray"></div>
		<canvas id="scratch" width="552" height="302">抱歉，您的手机不支持Canvas，不能参加此活动</canvas>
		<div class="result-show"><div class="content"></div></div>
		<div class="start-dialog" style="display: block;">
			<button class="start" type="submit">
				<span>开始刮奖</span>
				<div class="circle-spinner">
			      <div class="spinner-container container1">
			        <div class="circle1"></div>
			        <div class="circle2"></div>
			        <div class="circle3"></div>
			        <div class="circle4"></div>
			      </div>
			      <div class="spinner-container container2">
			        <div class="circle1"></div>
			        <div class="circle2"></div>
			        <div class="circle3"></div>
			        <div class="circle4"></div>
			      </div>
			      <div class="spinner-container container3">
			        <div class="circle1"></div>
			        <div class="circle2"></div>
			        <div class="circle3"></div>
			        <div class="circle4"></div>
			      </div>
			    </div>
    		</button>
			<p class="status-tip">免费次数：<span class="free-count">1000</span></p>
		</div>
		<div class="error-show">网络异常，购买失败</div>
	</div>
	<div class="lottery-area">
		<div class="title"><i></i><span>奖品说明</span><i></i></div>
		<div class="group">
			<img src="./刮刮卡_files/mfy41uz433.jpg">
			<div class="info">
				<h2>西十区30元优惠券</h2>
				<p>三朵花形优美、花片醇厚的厄瓜多尔红玫瑰意为“我爱你”</p>
			</div>
		</div>
		<div class="group">
			<img src="./刮刮卡_files/otuuafa7mm.jpg">
			<div class="info">
				<h2>苏宁满20减10</h2>
				<p>苏宁易购百货美妆母婴产品满20立减10，夏不为利！</p>
			</div>
		</div>
	</div>
	<div class="description">
		<div class="title"><i></i><span>活动说明</span><i></i></div>
		<div class="text">
			<h4>活动规则</h4>
            <ul>
                <li>当您参加积分抽奖时，兑换不同时间段内的一个或多个抽 奖编号，多个抽奖编号包括起号、止号以及中间连续编号为您所兑换的抽奖编号。当抽奖结束时，采用随机或人工抽取的形式抽取抽奖编号作为中奖标识。</li>
                <li>每期抽奖编号都从某个固定抽奖编号数开始，您兑换的抽奖编号可能会出现抽奖编号相同的情况，但是抽奖期日不同。您兑换到的抽奖编号仅代表您在本期对应奖品编号中的序列。</li>
                <li>每期抽奖活动只限于<a href="http://hd.dlp.duiba.com.cn/preview/scratchCard.html">该期该奖品</a>兑换到该抽奖编号的用户，不同期或不同奖品的相同编号的用户不在中奖范围内。期对应奖品编号中的序列.</li>
            </ul>
            <div class="probability-rules">
                <header>中奖概率说明<i></i></header>
                <section>
                    <ol>
                        <li>惊喜奖品中奖概率约为10%，5Q币中奖概率为1%，3元支付宝中奖概率为3%，再来一次中奖概率为25%，京东20元优惠券中奖概率为10%，话费1元中奖概率为3%，滴滴10元红包中奖概率为15%。</li>
                        <li>综合中奖概率为64%</li>
                    </ol>
                </section>
            </div>
		</div>
	</div>
	<div class="win-modal">
		<div class="modal-dialog">
			<i class="purple"></i>
			<i class="red"></i>
			<i class="red-small"></i>
			<i class="red-bottom"></i>
			<i class="purple-small"></i>
			<i class="yellow"></i>
			<i class="yellow-small"></i>
			<i class="heart"></i>
			<i class="pink1"></i>
			<i class="pink2"></i>
			<i class="pink3"></i>
			<i class="green1"></i>
			<i class="green2"></i>
			<i class="green3"></i>
			<i class="green-yellow"></i>
			<div class="main">
				<section class="lottery-info">
					<h2>恭喜你，中奖啦!</h2>
					<p class="title">欧舒丹护手霜</p>
					<img src="./刮刮卡_files/aseai547sx.jpg">
					<p class="help">也可到首页“兑换记录”领奖，24小时内有效!</p>
				</section>
				<footer>
					<a href="javascript:void(0)" class="cancel">继续刮奖</a><a href="javascript:void(0)" class="primary">马上领奖</a>
				</footer>
			</div>
		</div>
	</div>
	<a href="http://hd.dlp.duiba.com.cn/preview/scratchCard.html" class="record"></a>

<script src="./刮刮卡_files/zepto.min.js.下载"></script>
<script src="./刮刮卡_files/fastclick.js.下载"></script>
<script src="./刮刮卡_files/imgs.js.下载"></script>
<script>
var CFG={
    activityType:"credits",//credits:积分模式，free:自由模式
    login:true,//是否已登录
    activityId:1,//活动ID
    open:true,//活动开启状态
    limitType:'all',//限制抽奖的次数类型  all:永久,day:每天
    leaveCount:'1000',//剩余抽奖次数
    enoughCredits:false,//积分是否足够
    free:1000,//剩余免费次数
    needCredits:110,//活动需要积分
    unitName:'积分',//积分单位
    getCreditsLink:'http://www.duiba.com.cn'//获取更多积分链接
}
$(function(){
	//fastclick
	Origami.fastclick(document.body);
	//初始化抽奖状态
	function lotteryStatus(){
		if(CFG.open){
			if(CFG.login){
				if(CFG.activityType=='credits'){
		            if(CFG.limitType == 'day'){
		                if(CFG.leaveCount > 0 || CFG.leaveCount ===''){
		                    if(CFG.free>0){
		                        if(CFG.leaveCount ===''){
		                        	$('.status-tip').html('今日免费：'+'<span class="free-count">'+CFG.free+'</span>')
		                        }else{
		                        	$('.status-tip').html('今日免费：'+'<span class="free-count">'+(CFG.free>CFG.leaveCount?CFG.leaveCount:CFG.free)+'</span>');
		                        }
		                    }else{
		                    	if(CFG.enoughCredits){
		                    		$('.status-tip').html(CFG.needCredits+CFG.unitName+'/每次')
		                    	}else{
		                    		var NOCreditsHtml='<div class="start-dialog">';
		                    		NOCreditsHtml+='<div class="status-tip">Sorry,您的积分不足</div>';
		                    		if(CFG.getCreditsLink){
		                    			NOCreditsHtml+='<a class="getCredits">赚取积分</a>'
		                    		}
		                    		NOCreditsHtml+='</div>';
		                    		$('.start-dialog').html(NOCreditsHtml)
		                    	}
		                    }
		                }else{
		                    $('.start-dialog').html('您今日的抽奖次数已用完')
		                }
		            }else{
		                if(CFG.leaveCount > 0 || CFG.leaveCount ===''){
		                    if(CFG.free > 0){
		                        if(CFG.leaveCount ===''){
		                        	$('.status-tip').html('免费次数：'+'<span class="free-count">'+CFG.free+'</span>')
		                        }else{
		                        	$('.status-tip').html('免费次数：'+'<span class="free-count">'+(CFG.free>CFG.leaveCount?CFG.leaveCount:CFG.free)+'</span>')
		                        }
		                    }else{
		                        if(CFG.enoughCredits){
		                    		$('.status-tip').html(CFG.needCredits+CFG.unitName+'/每次')
		                    	}else{
		                    		var NOCreditsHtml='<div class="start-dialog">';
		                    		NOCreditsHtml+='<div class="status-tip">Sorry,您的积分不足</div>';
		                    		if(CFG.getCreditsLink){
		                    			NOCreditsHtml+='<a class="getCredits" href="'+CFG.getCreditsLink+'">赚取积分</a>'
		                    		}
		                    		NOCreditsHtml+='</div>';
		                    		$('.start-dialog').html(NOCreditsHtml)
		                    	}
		                    }
		                }else{
		                    $('.start-dialog').html('您抽奖次数已用完')
		                }
		            }
		        }else{
		            if(CFG.limitType == 'day'){
		                if( CFG.leaveCount >0 ){
		                    $('.status-tip').html('抽奖次数：'+CFG.leaveCount)
		                }else{
		                    $('.start-dialog').html('<strong>今日已抽完</strong>')
		                }
		            }else{
		                if(CFG.leaveCount>0 || CFG.leaveCount ===''){
		                    $('.status-tip').html('抽奖次数：'+CFG.leaveCount)
		                }else{
		                    $('.start-dialog').html('您抽奖次数已用完')
		                }
		            }
		        }
		   	}
		}else{
			$('.start-dialog').html('活动已结束')
		}
		$('.start-dialog').show();
    }
    lotteryStatus();

	var cvsWidth=552,cvsHeight=302;
	var myCanvas = document.getElementById('scratch');
	myCanvas.width=cvsWidth;
	myCanvas.height=cvsHeight;
	var gray = myCanvas.getContext('2d');

	myCanvas.addEventListener('touchmove', moveHandler,true);
	myCanvas.addEventListener('touchend', endHandler,false);
	function moveHandler(e){
		e.preventDefault();
		gray.beginPath();
		gray.fillStyle = "#f00";
		var offsetX=mouseDown?e.offsetX:(e.targetTouches[0].clientX-document.getElementById("scratch").getBoundingClientRect().left);
		var offsetY=mouseDown?e.offsetY:(e.targetTouches[0].clientY-document.getElementById("scratch").getBoundingClientRect().top);
		gray.arc(offsetX, offsetY, 40, 0, Math.PI*2);
		gray.fill();
		gray.closePath();
	}
	function endHandler(e){
		mouseDown=false;
		e.preventDefault();
		var num = 0;
		var datas = gray.getImageData((cvsWidth-250)/2,(cvsHeight-250)/2,250,250);
		for (var i = 0; i < datas.data.length; i++) {
			if (datas.data[i] == 0) {
				num++;
			};
		};
		if (num >= datas.data.length * 0.4) {
			gray.fillRect(0,0,cvsWidth,cvsHeight);
			$('.win-modal').show();
			document.ontouchmove=function(e){
				e.preventDefault();
			}
		};
	}
	//PC兼容
	myCanvas.addEventListener('mousedown', mouseStartHandler);
    myCanvas.addEventListener('mouseup', endHandler);
    myCanvas.addEventListener('mousemove', mouseMoveHandler);
    var mouseDown=false;
    function mouseStartHandler(e){
    	mouseDown=true;
    }
    function mouseMoveHandler(e){
    	if(mouseDown){
    		e.preventDefault();
			gray.beginPath();
			gray.fillStyle = "#f00";
			gray.arc(e.offsetX, e.offsetY, 40, 0, Math.PI*2);
			gray.fill();
			gray.closePath();
    	}
	}
	//PC兼容
	$('.start').on('click',function(){
		$(this).prop('disabled',true);
		$('.result-show .content').html('<img src="//yun.duiba.com.cn/images/mfy41uz433.jpg" width="200" height="200" /><p>西十区30元优惠券</p>');
		$('.lottery-info .title').html('西十区30元优惠券');
		$('.lottery-info img').html('//yun.duiba.com.cn/images/mfy41uz433.jpg');
		$('.lottery-info .help').show();
		$('.primary').html('马上领取')
		$('.primary').attr('href','')
		$('.start-dialog').hide();
		gray.globalCompositeOperation="destination-over";
		gray.beginPath();
		gray.fillStyle = "#979797";
		gray.fillRect(0,0,cvsWidth,cvsHeight);
		gray.closePath();
		gray.globalCompositeOperation="source-over";
	    gray.font = '36px Hiragino Sans GB,STHeiTi';
	    gray.fillStyle = '#e5e5e5';
	    gray.fillText('使劲刮我(｡ì _ í｡)', 156, 156);
		gray.globalCompositeOperation="destination-out";
    	$('.scratch-cover-gray').show().css({'right':15});
		$('#scratch,.result-show').show();
		$('.scratch-cover-yellow,.scratch-cover-gray').hide();
	});
	$('.cancel').on('click',function(){
		$('.win-modal').hide();
		document.ontouchmove=null;
		init();
	})
	$('.primary').on('click',function(){
		$('.win-modal').hide();
	})
	function init(){
		$('.start').prop('disabled',false);
		$('.scratch-cover-yellow').show();
		$('.scratch-cover-gray').css('right',-620);
		$('.result-show').hide().find('.content').html('');
		$('.error-show').hide();
		$('#scratch').hide();
		lotteryStatus();
	}
	function errorShow(){
		$('.scratch-cover-yellow,.start-dialog,.result-show,#scratch').hide();
		$('.error-show').show();
		setTimeout(function(){
			init();
		},1000)
	}
    $('.probability-rules header').on('click',function(){
        $(this).toggleClass('show');
        $('.probability-rules section').toggleClass('show');
    })
});
(function($, undefined) {
    var prefix = '',
        eventPrefix,
        vendors = {
            Webkit: 'webkit',
            Moz: '',
            O: 'o'
        },
        testEl = document.createElement('div'),
        supportedTransforms = /^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i,
        transform,
        transitionProperty, transitionDuration, transitionTiming, transitionDelay,
        animationName, animationDuration, animationTiming, animationDelay,
        cssReset = {}

    function dasherize(str) {
        return str.replace(/([a-z])([A-Z])/, '$1-$2').toLowerCase()
    }

    function normalizeEvent(name) {
        return eventPrefix ? eventPrefix + name : name.toLowerCase()
    }

    $.each(vendors, function(vendor, event) {
        if (testEl.style[vendor + 'TransitionProperty'] !== undefined) {
            prefix = '-' + vendor.toLowerCase() + '-'
            eventPrefix = event
            return false
        }
    })

    transform = prefix + 'transform'
    cssReset[transitionProperty = prefix + 'transition-property'] =
        cssReset[transitionDuration = prefix + 'transition-duration'] =
        cssReset[transitionDelay = prefix + 'transition-delay'] =
        cssReset[transitionTiming = prefix + 'transition-timing-function'] =
        cssReset[animationName = prefix + 'animation-name'] =
        cssReset[animationDuration = prefix + 'animation-duration'] =
        cssReset[animationDelay = prefix + 'animation-delay'] =
        cssReset[animationTiming = prefix + 'animation-timing-function'] = ''

    $.fx = {
        off: (eventPrefix === undefined && testEl.style.transitionProperty === undefined),
        speeds: {
            _default: 400,
            fast: 200,
            slow: 600
        },
        cssPrefix: prefix,
        transitionEnd: normalizeEvent('TransitionEnd'),
        animationEnd: normalizeEvent('AnimationEnd')
    }

    $.fn.animate = function(properties, duration, ease, callback, delay) {
        if ($.isFunction(duration))
            callback = duration, ease = undefined, duration = undefined
        if ($.isFunction(ease))
            callback = ease, ease = undefined
        if ($.isPlainObject(duration))
            ease = duration.easing, callback = duration.complete, delay = duration.delay, duration = duration.duration
        if (duration) duration = (typeof duration == 'number' ? duration :
            ($.fx.speeds[duration] || $.fx.speeds._default)) / 1000
        if (delay) delay = parseFloat(delay) / 1000
        return this.anim(properties, duration, ease, callback, delay)
    }

    $.fn.anim = function(properties, duration, ease, callback, delay) {
        var key, cssValues = {},
            cssProperties, transforms = '',
            that = this,
            wrappedCallback, endEvent = $.fx.transitionEnd,
            fired = false

        if (duration === undefined) duration = $.fx.speeds._default / 1000
        if (delay === undefined) delay = 0
        if ($.fx.off) duration = 0

        if (typeof properties == 'string') {
            // keyframe animation
            cssValues[animationName] = properties
            cssValues[animationDuration] = duration + 's'
            cssValues[animationDelay] = delay + 's'
            cssValues[animationTiming] = (ease || 'linear')
            endEvent = $.fx.animationEnd
        } else {
            cssProperties = []
                // CSS transitions
            for (key in properties)
                if (supportedTransforms.test(key)) transforms += key + '(' + properties[key] + ') '
                else cssValues[key] = properties[key], cssProperties.push(dasherize(key))

            if (transforms) cssValues[transform] = transforms, cssProperties.push(transform)
            if (duration > 0 && typeof properties === 'object') {
                cssValues[transitionProperty] = cssProperties.join(', ')
                cssValues[transitionDuration] = duration + 's'
                cssValues[transitionDelay] = delay + 's'
                cssValues[transitionTiming] = (ease || 'linear')
            }
        }

        wrappedCallback = function(event) {
            if (typeof event !== 'undefined') {
                if (event.target !== event.currentTarget) return // makes sure the event didn't bubble from "below"
                $(event.target).unbind(endEvent, wrappedCallback)
            } else
                $(this).unbind(endEvent, wrappedCallback) // triggered by setTimeout

            fired = true
            $(this).css(cssReset)
            callback && callback.call(this)
        }
        if (duration > 0) {
            this.bind(endEvent, wrappedCallback)
                // transitionEnd is not always firing on older Android phones
                // so make sure it gets fired
            setTimeout(function() {
                if (fired) return
                wrappedCallback.call(that)
            }, ((duration + delay) * 1000) + 25)
        }

        // trigger page reflow so new elements can animate
        this.size() && this.get(0).clientLeft

        this.css(cssValues)

        if (duration <= 0) setTimeout(function() {
            that.each(function() {
                wrappedCallback.call(this)
            })
        }, 0)

        return this
    }

    testEl = null
})(Zepto)
</script>

</body></html>